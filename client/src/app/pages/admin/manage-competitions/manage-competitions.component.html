<div class="container">

  <div class="row">
    <div class="col-full">
      <h1>Manage Competitions</h1>
    </div>
  </div>

  <div class="row">
    <div class="col-half">
      <a (click)="startAddCompetition()" class="btn btn-primary btn-sm">Add Competition</a>
    </div>
    <div class="col-half">
      <div class="form-group has-feedback">
        <label class="sr-only control-label" for="compsearch">Search</label>
        <input type="text" class="form-control" id="compsearch" placeholder="Search competitions" [(ngModel)]="searchFilter">
        <i class="glyphicon glyphicon-search form-control-feedback"></i>
      </div>    
    </div>
  </div>

  <ul class="list-group user-list">
    <li class="list-group-item" *ngFor="let comp of getFilteredCompetitions()">
      <div class="comp-info">

        <h4>
          <span class="label label-danger label-past" *ngIf="isOld(comp)"> Past </span> 
          <strong>{{comp.name}}</strong>
        </h4>

        <div class="comp-info-element">
          {{comp.venue}}<br>
          <span class="text-muted small">{{comp.address}}</span>        
        </div>
        <div class="comp-info-element">
          {{comp.city}}, <strong>{{comp.province}}</strong>
        </div>
        <div class="comp-info-element">
          {{comp.startDate | date : 'EEE, d MMM yyyy'}}
          <span *ngIf="comp.endDate > comp.startDate"> - {{comp.endDate | date : 'EEE, d MMM yyyy'}}</span>
        </div>

        <div class="comp-info-controls">
          <a *ngIf="!isOld(comp) && !comp.notificationsSent" (click)="startSendNotifications(comp)" class="btn btn-primary btn-sm">Send</a>
          <a *ngIf="!isOld(comp)" (click)="startEditCompetition(comp)" class="btn btn-primary btn-sm">Edit</a>
          <a (click)="startDeleteCompetition(comp)" class="btn btn-primary btn-sm">Delete</a>
        </div>

      </div>      
    </li>
  </ul>

</div>

<app-modal id="comp-edit-modal">
  <app-comp-edit-box 
    [competition]="selectedCompetition" 
    [saveFn]="saveCompetition.bind(this)" 
    [closeFn]="closeEditModal.bind(this)"
  />
</app-modal>

<app-modal id="comp-delete-confirm-modal">
  <h4>Delete</h4>
  <p>
    Are you sure you want to delete 
    <strong>{{selectedCompetition.name}}</strong> 
    permanently?</p><p>This action cannot be undone.
  </p>
  <button (click)="deleteSelectedCompetition()">Delete</button>
  <button (click)="closeConfirmDeleteModal()">Cancel</button>
</app-modal>

<app-modal id="comp-send-notifications-modal">
  <h4>Confirm notifications send</h4>
  <p>
    Are you sure you want to send an announcement email 
    for <strong>{{selectedCompetition.name}}</strong> to 
    all users who have enabled notifications
    for <strong>{{selectedCompetition.province}}</strong>?
  </p>
  <button (click)="sendNotifications()">Send</button>
  <button (click)="closeSendNotificationsModal()">Cancel</button>
</app-modal>